<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>코드 스피츠 예제1</title>
</head>
<body>
   <section id="data"></section>
<script>
   const Info = class{
       constructor(json) {
           const [title, header, items] = json;

           if(!title || typeof title != 'string') throw 'invalid title';
           if(!Array.isArray(header) || !header.length) throw 'invalid header';
           if(!Array.isArray(items) || !items.length) throw 'invalid items';

           this._private = {title, header, items};
       }
       get title() {return this._private.title;}
       get header() {return this._private.header;}
       get items() {return this._private.items;}
   };

   const Data = class{
       async getData (){
           const json = await this._getData();
           return new Info(json);
       }
       async _getData(){
           throw "_ getData must overrided ";
       }
   };
   const JsonData = class extends Data{
       constructor(data){
           super();
           this._data = data;
       }
       async _getData(){
           let json ;
           if( typeof this._data == 'string'){
               const response = await fetch( this._data );
               return await response.json();
           }else return this._data ;
       }
   };
   const Renderer = class{
       constructor(){}
       async render(data, {title='title', header='header', items='items'}){
           if(!(data instanceof Data)) throw "invalid data type";
           this._info = await data.getData({title, header, items});
           this._render();
       }

       _render() {
           throw '_render must overrided';
       }
   }

   const TableRenderer = class extends Renderer{
       constructor(parent){
           if(typeof parent != 'string' || !parent) throw 'invalid param';
           super();
           this._parent = parent;
       }

       _render() {
           const parent = document.querySelector(this._parent);
           if(!parent) throw 'invalid parent';
           parent.innerHTML = '';
           const [table, caption] = 'table,caption'.split(',').map(v=>document.createElement(v));
           caption.innerHTML = this._info.title;
           table.appendChild(caption);
           table.appendChild(
               this._info.header.reduce(
                   (thead, data)=>(thead.appendChild(document.createElement('th')).innerHTML = data, thead),
                   document.createElement('thead')
               )
           );

           parent.appendChild(
               this._info.items.reduce(
                   (table, row) => (table.appendChild(
                       row.reduce(
                           (tr, data) => (tr.appendChild(document.createElement('td')).innerHTML = data, tr),
                           document.createElement('tr')
                       )
                   ), table)
               , table)
           );
       }
   }    

   const data = new JsonData('71_1.json');
   const renderer = new TableRenderer('#data');
   renderer.render(data);
   
</script>
</body>
</html>
